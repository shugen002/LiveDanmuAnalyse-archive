# LiveDanmuAnalyse B站直播弹幕分析

一个算是半成品级别的自动弹幕举报机，自己手动写的规则没有没有放出。避免反向给他们打广告。

## 起因

最近破站直播垃圾弹幕实在多了，然后有人拿java搓了一波弹幕分析处理，原理是然后我也挺不服的，原因是

* Java什么勾吧玩意（确实有点小歧视，要是拿python我就服了）
* 误伤也挺多的。。。
* 没有一开始就上举报

但是自己做下来之后，整了一波半自动生成正则匹配之后，就感觉还是得想办法抄抄他的代码，看看他怎么做的。。。

## 目前状态

* 会使用`config/cookie.txt`中的cookie发送举报请求。（直接把cookie放进里面就可以了）
* 会自动以每秒一个房间的速度连接B站主要的5个直播分区的前三页的直播间，每十分钟更新一次列表，自动替换掉掉出列表的直播间。
* 根据提供的字符串和数字按照特定规则生成正则匹配规则
* 允许手动提供多个正则并指定权重，权重超过5后自动举报
* 限制自动举报的速度。根据和破站垃圾客服对线和实操结果可知，举报需要限速以免被送入黑名单（对，就算你是真实有效不重复(非同一用户，非同一条弹幕)的举报，你速度过快也会被送进黑名单，具体限速研究成本过大，未作仔细研究）
* 会自动上传所有弹幕到`config/elastichost.txt`中的elastic数据库中，方便后续分析。(直接把http链接写进去就可以了)
* 允许定义多个分析器在`config/analysers.json`

```json
[
  {
    "matchNumber": [
      123456789 // 多个你要匹配的数字，会自动根据定义的码表生成匹配，支持对抗数字被分割成多片的情况
    ],
    "matchString":[
      "你要匹配的字符串" //同样支持对抗字符串中间被插入奇怪东西的情况
    ],
    "matchRule": [ // 手动定义正则区域，不需要开头和结尾的斜杠
      {
        "regex": "君.{0,2}羊", // 匹配出现群字被拆成君羊并且中间被插入最多两个任意私服的情况
        "weight": 1 // 若匹配上，赋予1的权重，目前是大于等于5就触发举报
      },
    ],
    "reason": { // 举报的理由，在 https://api.live.bilibili.com/xlive/web-ucenter/v1/dMReport/ForReason 中查看
      "id": 3,
      "reason": "垃圾广告" 
    } // 不过我觉得没啥卵用就是。
  }
]
```
* 当垃圾弹幕出现在`rooms.json`中的直播间时，自动发送禁言请求，但未能做到保证列表中的所有房间都会被连接监听。

## 后续

近期应该是考虑把弹幕存到其他数据库，方便分析，感觉elastic不是很舒服。

长远的话，把规则的编写放到TG群之类的地方去，然后找几个会正则的人帮忙写下规则，自己当甩手掌柜。

或者尝试炼个丹？